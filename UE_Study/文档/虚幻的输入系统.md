## 一、UE5 输入系统概览

UE5.7 中存在两套输入体系：

| 输入系统                           | 状态   | 是否推荐     |
| ------------------------------ | ---- | -------- |
| 旧输入系统（InputAxis / InputAction） | 兼容保留 | ❌ 不推荐新项目 |
| Enhanced Input（增强输入系统）         | 官方主推 | ✅ 强烈推荐   |

> [!tip] 刚需的头文件
> ‘#include "EnhancedInputComponent.h"
> ’#include "EnhancedInputSubsystems.h" 
> ‘#include "InputActionValue.h"

---

## 二、增强输入系统（Enhanced Input）架构说明

### 1️⃣ 核心组成

|组件|作用|
|---|---|
|Input Action（IA）|抽象行为（跳跃 / 移动 / 开火）|
|Input Mapping Context（IMC）|键位与行为映射|
|Enhanced Input Component|代替传统 InputComponent|
|Enhanced Input Subsystem|管理 Context（可动态切换）|
|Modifier|输入修正（反向 / 灵敏度）|
|Trigger|触发条件（按下 / 长按 / 连击）|

---

### 2️⃣ 输入逻辑结构

物理设备（键盘 / 手柄 / 鼠标）         
↓ 
Input Mapping Context（IMC）         
↓ 
Input Action（IA_Move / IA_Look）        
↓
C++ BindAction         
↓ 
游戏逻辑函数

---

## 三、项目初始化配置

### ✅ 1. 启用 Enhanced Input 插件

> 默认 UE5.7 已启用，如有异常请检查：

`Edit → Plugins → Input → Enhanced Input（勾选）`

---

### ✅ 2. 设置默认输入组件

确认启用 Enhanced Input：

`; DefaultEngine.ini [/Script/Engine.InputSettings] DefaultPlayerInputClass=/Script/EnhancedInput.EnhancedPlayerInput DefaultInputComponentClass=/Script/EnhancedInput.EnhancedInputComponent`

> 一般 **UE5 新项目已自动配置**

---

## 四、Input Assets 资源准备（编辑器）

### 1️⃣ 创建 Input Action（IA）

**举例（FPS 常用）：**

|名称|Value Type|
|---|---|
|IA_Move|Axis2D|
|IA_Look|Axis2D|
|IA_Jump|Bool|
|IA_Fire|Bool|
|IA_Run|Bool|

---

### 2️⃣ 创建 Input Mapping Context（IMC）

示例映射：

|Input Action|键位|
|---|---|
|IA_Move|WASD|
|IA_Look|Mouse X / Mouse Y|
|IA_Jump|Space|
|IA_Fire|Left Mouse|
|IA_Run|Left Shift|

---

## 五、C++ 中接入 Enhanced Input

---

###  Step 1：Character/Pawn C++类的.h文件中
```
// Fill out your copyright notice in the Description page of Project Settings.

#pragma once

#include "CoreMinimal.h"
#include "TestFPSMovementComponent.h"
#include "Camera/CameraComponent.h"
#include "GameFramework/Character.h"
#include "GameFramework/SpringArmComponent.h"
#include "TestFPSCharacter.generated.h"

struct FInputActionValue;
class UInputAction;

UCLASS()
class TESTPROJECT_API ATestFPSCharacter : public ACharacter
{
	GENERATED_BODY()

public:
	// Sets default values for this character's properties
	ATestFPSCharacter(const FObjectInitializer& ObjectInitializer);

protected:


	/** Move Input Action */
	UPROPERTY(EditAnywhere, Category = "Input")
	UInputAction* MoveAction;

	/** Mouse Look Input Action */
	UPROPERTY(EditAnywhere, Category = "Input")
	UInputAction* MouseLookAction;

	UPROPERTY(EditAnywhere, Category = "Input")
    UInputAction* AimAction;

	UPROPERTY(EditAnywhere, Category = "Input")
	UInputAction* RunAction;

	/** Called from Input Actions for movement input */
	void MoveInput(const FInputActionValue& Value);

	/** Called from Input Actions for looking input */
	void LookInput(const FInputActionValue& Value);

	void StartAimInput(const FInputActionValue& Value);

	void StopAimInput(const FInputActionValue& Value);

	void StartRunInput(const FInputActionValue& Value);

	void StopRunInput(const FInputActionValue& Value);

	/** Handles aim inputs from either controls or UI interfaces */
	UFUNCTION(BlueprintCallable, Category = "Input")
	virtual void DoLook(float Yaw, float Pitch);

	/** Handles move inputs from either controls or UI interfaces */
	UFUNCTION(BlueprintCallable, Category = "Input")
	virtual void DoMove(float Right, float Forward);

	UFUNCTION(BlueprintCallable, Category = "Input")
	virtual void SetSpeed(float Speed);

public:	


	// Called to bind functionality to input
	virtual void SetupPlayerInputComponent(class UInputComponent* PlayerInputComponent) override;

};

```

其中 protected部分声明了 属性：输入操作（UInputAction）和回调函数

###  Step 2：Character/Pawn C++类的.cpp文件中
```
// Fill out your copyright notice in the Description page of Project Settings.


#include "TestFPSCharacter.h"
#include "EnhancedInputComponent.h"
#include "EnhancedInputSubsystems.h" 
#include "InputActionValue.h"
#include "GameFramework/CharacterMovementComponent.h"
#include "Components/CapsuleComponent.h"

// Sets default values
ATestFPSCharacter::ATestFPSCharacter(const FObjectInitializer& ObjectInitializer)
	: Super(
		ObjectInitializer.SetDefaultSubobjectClass<
			UTestFPSMovementComponent
		>(CharacterMovementComponentName)
	)
{
 	// Set this character to call Tick() every frame.  You can turn this off to improve performance if you don't need it.
	PrimaryActorTick.bCanEverTick = true;
	Move = GetFPSMovement();
}
// Called to bind functionality to input
void ATestFPSCharacter::SetupPlayerInputComponent(UInputComponent* PlayerInputComponent)
{
	Super::SetupPlayerInputComponent(PlayerInputComponent);
	if (UEnhancedInputComponent* EnhancedInputComponent = CastChecked<UEnhancedInputComponent>(PlayerInputComponent))
	{
		EnhancedInputComponent->BindAction(MoveAction, ETriggerEvent::Triggered, this, &ATestFPSCharacter::MoveInput);
		EnhancedInputComponent->BindAction(MouseLookAction, ETriggerEvent::Triggered, this, &ATestFPSCharacter::LookInput);

        EnhancedInputComponent->BindAction(AimAction, ETriggerEvent::Triggered, this, &ATestFPSCharacter::StartAimInput);
        EnhancedInputComponent->BindAction(AimAction, ETriggerEvent::Completed, this, &ATestFPSCharacter::StopAimInput);

		EnhancedInputComponent->BindAction(RunAction, ETriggerEvent::Triggered, this, &ATestFPSCharacter::StartRunInput);
        EnhancedInputComponent->BindAction(RunAction, ETriggerEvent::Completed, this, &ATestFPSCharacter::StopRunInput);
	}
}

void ATestFPSCharacter::MoveInput(const FInputActionValue& Value)
{
    FVector2D MovementVector = Value.Get<FVector2D>();
    DoMove(MovementVector.X, MovementVector.Y);
}

void ATestFPSCharacter::LookInput(const FInputActionValue& Value)
{
    FVector2D LookVector = Value.Get<FVector2D>();
    DoLook(LookVector.X, LookVector.Y);
}

void ATestFPSCharacter::StartAimInput(const FInputActionValue& Value)
{
	bIsAiming = true;
	SetSpeed(Move->AimSpeed);
	
}

void ATestFPSCharacter::StopAimInput(const FInputActionValue& Value)
{
	bIsAiming = false;
	SetSpeed(Move->WalkSpeed);
}

void ATestFPSCharacter::StartRunInput(const FInputActionValue& Value)
{
	SetSpeed(Move->RunSpeed);
}

void ATestFPSCharacter::StopRunInput(const FInputActionValue& Value)
{
	SetSpeed(Move->WalkSpeed);
}

void ATestFPSCharacter::DoLook(float Yaw, float Pitch)
{
	if (GetController())
	{
		// pass the rotation inputs
		AddControllerYawInput(Yaw);
		AddControllerPitchInput(Pitch);
	}
}

void ATestFPSCharacter::DoMove(float Right, float Forward)
{
	if (GetController())
	{
		// pass the move inputs
		AddMovementInput(GetActorRightVector(), Right);
		AddMovementInput(GetActorForwardVector(), Forward);
	}
}

void ATestFPSCharacter::SetSpeed(float Speed)
{
	if (Move)
	{
        Move->MaxWalkSpeed = Speed;
	}
}


```
主要是在SetupPlayerInputComponent()函数中绑定输入操作和定义函数

###  Step 3：在PlayerController C++类的文件中将输入映射上下文绑定到角色（可以在Player Controller中实现，也可以在角色类BeginPlay中实现）

使用增强输入本地玩家子系统(UEnhancedInputLocalPlayerSubsystem)

.h
```
// Fill out your copyright notice in the Description page of Project Settings.

#pragma once

#include "CoreMinimal.h"
#include "GameFramework/PlayerController.h"
#include "TestFPSPlayerController.generated.h"

UCLASS()
class TESTPROJECT_API ATestFPSPlayerController : public APlayerController
{
	GENERATED_BODY()
	
protected:

	/** Input Mapping Contexts */
	UPROPERTY(EditAnywhere, Category = "Input|Input Mappings")
	TArray<class UInputMappingContext*> DefaultMappingContexts;


	/** Input mapping context setup */
	virtual void SetupInputComponent() override;
};
```
.cpp
```
// Fill out your copyright notice in the Description page of Project Settings.


#include "TestFPSPlayerController.h"
#include "EnhancedInputSubsystems.h" 

void ATestFPSPlayerController::SetupInputComponent()
{
	Super::SetupInputComponent();

	// only add IMCs for local player controllers
	if (IsLocalPlayerController())
	{
		// Add Input Mapping Context
		if (UEnhancedInputLocalPlayerSubsystem* Subsystem = ULocalPlayer::GetSubsystem<UEnhancedInputLocalPlayerSubsystem>(GetLocalPlayer()))
		{
			for (UInputMappingContext* CurrentContext : DefaultMappingContexts)
			{
				Subsystem->AddMappingContext(CurrentContext, 0);
			}
		}
	}
}
```

## 六、Trigger（触发器）使用说明

|Trigger|行为|
|---|---|
|Started|按下瞬间|
|Triggered|持续输入|
|Completed|松开|
|Ongoing|满足条件中|


---

## 七、Modifier（修饰器）常见用途

|Modifier|用途|
|---|---|
|Negate|轴反向|
|Scale|灵敏度|
|DeadZone|手柄死区|
|Swizzle|轴互换|

✅ 推荐：**灵敏度与反转在 Modifier，而非 C++ 中处理**

---

## 八、运行时动态切换输入（高级）

### 示例：进入 UI 模式
```
Subsystem->RemoveMappingContext(DefaultMappingContext); 
Subsystem->AddMappingContext(UIMappingContext, 1);
```
> ✅ **优先级越高覆盖越低**