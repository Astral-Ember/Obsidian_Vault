引擎中测试
![[Pasted image 20251205162146.png]]

LAN 局域网设置
![[Pasted image 20251205164638.png]]

在C++中同样可以进行设置
在定义的Player/Character 就是自定义的玩家C++类的文件
在.h中声明
```
	UFUNCTION(BlueprintCallable)
	void OponLevel();

	UFUNCTION(BlueprintCallable)
	void CallOpenLevel(const FString& Address);

	UFUNCTION(BlueprintCallable)
	void CallClinetTravel(const FString& Address);
```
在.cpp中定义
```
/**
 * @brief 在服务器上打开指定关卡
 * 
 * 该函数获取当前世界实例，并在服务器上调用ServerTravel方法来切换到指定关卡。
 * 目标关卡为"/Game/Lobby.Lobby"，使用listen模式启动。
 */
void AFPS_ProjectCharacter::OponLevel()
{
	// 获取当前游戏世界实例
	UWorld* World = GetWorld();
	if (World)
	{
		// 在服务器上跳转到大厅关卡
		World->ServerTravel("/Game/Lobby.Lobby?listen");
	}
}

/**
 * @brief 打开指定地址的关卡
 * 
 * 该函数使用UGameplayStatics工具类来加载并切换到指定路径的关卡。
 * 
 * @param Address 要打开的关卡地址路径
 */
void AFPS_ProjectCharacter::CallOpenLevel(const FString& Address)
{
	// 使用游戏静态工具类打开指定关卡
	UGameplayStatics::OpenLevel(this, *Address);
}

/**
 * @brief 客户端跳转到指定地址
 * 
 * 该函数获取玩家控制器并在客户端执行关卡跳转操作。
 * 
 * @param Address 要跳转到的目标地址
 */
void AFPS_ProjectCharacter::CallClinetTravel(const FString& Address)
{
	// 获取本地玩家控制器并执行客户端跳转
	if (APlayerController* PlayerController = GetGameInstance()->GetFirstLocalPlayerController())
	{
		// 客户端跳转到指定地址，使用绝对路径方式
		PlayerController->ClientTravel(Address, ETravelType::TRAVEL_Absolute);
	}
}
```

在角色蓝图中就可以调用这些UFUNCTION
![[Pasted image 20251205173731.png]]


### 使用的三个函数
Unreal Engine中的关卡切换机制
ServerTravel
	作用: 服务器端发起的关卡切换，用于多人游戏中的全局地图转换
	特点:
	仅在服务器上调用
	会同步到所有连接的客户端
	保持网络连接状态
	适用于游戏模式变更或大型场景切换
OpenLevel
	作用: 直接打开指定关卡，通常用于单机游戏
	特点:
	可在客户端或服务器上调用
	立即加载新关卡
	会断开现有网络连接
	不会通知其他客户端
ClientTravel
	作用: 客户端请求连接到新的服务器或关卡
	特点:
	在客户端上调用
	通常用于连接不同服务器或重新连接
	可以携带连接参数
	适用于玩家主动切换服务器场景
这三种机制分别服务于不同的网络拓扑和游戏架构需求。
